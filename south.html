<script>
  const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRnmUI7H349bNblbSqP-EW6X7ZKeDUwprhSdhsgP_9dXJEPrhy8I9gzDgXOX8sOEQZ2uUULtPtKluB-/pub?gid=978452653&single=true&output=csv";

  function parseCSV(data) {
    const lines = data.trim().split("\n").map(line => line.split(","));
    const headers = lines[0];
    return lines.slice(1).map(row => {
      const obj = {};
      headers.forEach((h, i) => obj[h.trim()] = row[i]?.trim() || "");
      return obj;
    });
  }

  function renderTable(rows, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    const tbody = document.createElement("tbody");

    const columns = ["Rank", "Brewer", "Total", "MF25", "SCRHC25", "PBC25", "RTB25", "AFC25"];

    const headerRow = document.createElement("tr");
    columns.forEach(col => {
      const th = document.createElement("th");
      th.textContent = col;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    rows.forEach(row => {
      if (parseInt(row["Total"]) > 0) {
        const tr = document.createElement("tr");
        columns.forEach(col => {
          const td = document.createElement("td");
          td.textContent = row[col] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    container.appendChild(table);
  }

  fetch(csvUrl)
    .then(response => response.text())
    .then(csv => {
      const data = parseCSV(csv);
      data.sort((a, b) => parseInt(a.Rank) - parseInt(b.Rank));
      renderTable(data, "south-results");
    })
    .catch(err => {
      const container = document.getElementById("south-results");
      container.innerHTML = "<p>Error loading data.</p>";
      console.error(err);
    });
</script>
